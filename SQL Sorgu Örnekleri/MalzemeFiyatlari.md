--ALTER VIEW  NR_023_MALZEME_FIYATLARI AS 
SELECT 
DISTINCT(I.CODE) [MALZEME KODU],

I.NAME [MALZEME AÇIKLAMASI],

M.ONHAND [MİKTAR],

(SELECT TOP 1 D.PRICE FROM LG_023_PRCLIST D WHERE D.CARDREF=I.LOGICALREF AND D.PTYPE=1  AND ACTIVE=0 ORDER BY D.BEGDATE DESC) AS [ALIŞ FİYATI],
 
(SELECT TOP 1 D.PRICE FROM LG_023_PRCLIST D WHERE D.CARDREF=I.LOGICALREF AND D.PTYPE=2  AND ACTIVE=0 ORDER BY D.BEGDATE DESC) AS [SATIŞ FİYATI],

(SELECT TOP 1 D.BEGDATE FROM LG_023_PRCLIST D WHERE D.CARDREF=I.LOGICALREF AND ACTIVE=0 ORDER BY D.BEGDATE DESC) AS [BAŞLANGIÇ TARİHİ],

(SELECT TOP 1 D.ENDDATE FROM LG_023_PRCLIST D WHERE D.CARDREF=I.LOGICALREF AND ACTIVE=0 ORDER BY D.BEGDATE DESC) AS [BİTİŞ TARİHİ]

FROM LG_023_ITEMS I 
LEFT JOIN LG_023_PRCLIST F ON F.CARDREF=I.LOGICALREF AND F.ACTIVE=0 
LEFT JOIN LV_023_01_GNTOTST M ON M.STOCKREF=I.LOGICALREF AND INVENNO=-1 

WHERE F.PRICE IS NOT NULL
