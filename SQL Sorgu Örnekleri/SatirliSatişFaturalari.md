--CREATE VIEW NR_204_SATIS_FATURA_DOKUMU AS
SELECT 
CASE WHEN INVFC.TRCODE=8 THEN 'TOPTAN SATIŞ FATURASI' WHEN INVFC.TRCODE=9 THEN  'VERİLEN HİZMET FATURASI'WHEN INVFC.TRCODE=3 THEN  'TOPTAN SATIŞ İADE' ELSE 'DİĞER' END  "Fiş Türü", 
INVFC.FICHENO "Fatura No",
INVFC.DATE_ "Fatura Tarihi",
CLNTC.CODE "Cari Kodu",
CLNTC.DEFINITION_ "Cari Açıklaması", 
COALESCE(I.CODE,H.CODE) "Malzeme Kodu",
COALESCE(I.NAME,H.DEFINITION_) "Malzeme Açıklaması",
SL.AMOUNT"MİKTAR",
CASE WHEN SL.TRCURR=0 THEN 'TL'WHEN SL.TRCURR=20 THEN 'EUR'WHEN SL.TRCURR=1 THEN 'USD'  WHEN SL.TRCURR=160 THEN 'TL'ELSE 'DİĞER' END "DÖVİZ TÜRÜ",
SL.PRICE"BİRİM FİYAT",
SL.TOTAL"SATIR TUTARI",
SL.VAT"KDV ORANI",
SL.VATAMNT"KDV TUTARI",
SL.DISTDISC"SATIR İNDİRİM TUTARI",
SL.LINENET"SATIR NET TUTARI"
FROM LG_204_CLCARD CLNTC
 LEFT JOIN LG_204_01_INVOICE INVFC ON  INVFC.CLIENTREF = CLNTC.LOGICALREF
 LEFT JOIN LG_204_01_STLINE SL ON SL.INVOICEREF=INVFC.LOGICALREF 
 LEFT JOIN LG_204_ITEMS I ON I.LOGICALREF=SL.STOCKREF  AND SL.LINETYPE=0
 LEFT JOIN LG_204_SRVCARD H ON H.LOGICALREF=SL.STOCKREF AND SL.LINETYPE=4
WHERE (INVFC.CANCELLED = 0)  AND INVFC.GRPCODE=2 

--ORDER BY INVFC.FICHENO


